app.factory('Sheriff',function($q,$http,$sce,settings){

    var accesstoken = localStorage.access_token;

    this.connect = function(){
  

        var url = settings.moduleServer+'/authorize';
        var deferred = $q.defer();

        $http({
              method: 'GET',
              url: url,
              params : { access_token : localStorage.access_token}
          }).then(function successCallback(response) {
            
             deferred.resolve(response);
            
          }, function errorCallback(response) {
              
             deferred.reject(response);
              
             if(response.status == 401) localStorage.access_token = null;
          });

        return deferred.promise;
    }
    
    this.get = function(path,parameters = []){
  
        
        var url = settings.moduleServer+'/'+path;
        var deferred = $q.defer();
        var params ={ access_token : localStorage.access_token};
        params = $.extend(params,parameters);
        
        $http({
              method: 'GET',
              url: url,
              params : params
          }).then(function successCallback(response) {
            
             deferred.resolve(response);
            
             
          }, function errorCallback(response) {
              
             deferred.reject(response);
              
             if(response.status == 401) accesstoken = null;
          });

        return deferred.promise;
    }
    
    
    
    
    
    
    
    return({
        connect: this.connect,
        get: this.get
    });
    
});
